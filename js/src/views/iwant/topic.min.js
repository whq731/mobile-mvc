define("jquery underscore backbone src/views/iwant/originals text!src/tpl/iwant/topic.tpl text!src/tpl/iwant/header-self.tpl text!src/tpl/iwant/header-topic.tpl".split(" "),function(a,f,g,m,h,k,l){return g.View.extend({el:"#frame",template:f.template(h),page_size:cfg.page_size,topic_type:1,events:{"click .follow":"follow","click .longdetail":"detail","click .shortdetail":"detail","click .add":"addTopic","tap [onclick='return false;']":"tapLocation"},tapLocation:function(d){d=a(d.currentTarget).attr("href");
location.href=d},locationToMe:function(){ajax_request({action:"iwant_get_login_user"}).then(function(a){location.href=a.cust_id&&0<a.cust_id?"#me":cfg.login_link})},originalsViewInstance:!1,addTopic:function(){location.href=cfg.sns_publish_link.replace("{%type%}","1").replace("{%topic_id%}",this.topic_id)},fixedDetail:function(){0==a(window).scrollTop()?a(".arrow_header").hasClass("hide")?(a("#doc-detail").show(),a(".arrow_header").removeClass("hide")):(a("#doc-detail").hide(),a("#fixed-detail").css("top",
"-100px"),a(".arrow_header").addClass("hide")):a(".arrow_header").hasClass("hide")?(a("#fixed-detail").css("top","48.5px"),a(".arrow_header").removeClass("hide")):(a("#doc-detail").hide(),a("#fixed-detail").css("top","-100px"),a(".arrow_header").addClass("hide"))},detail:function(){a(".shortdetail").toggle();a(".longdetail").toggle()},follow:function(){var d=this;ajax_request({action:"iwant_set_concern_topic",topic_id:this.topic_id}).then(function(b){0==b.errorCode&&(1==d.topic_type?a(".follow").hasClass("already")?
(a(".follow").text("\u5173\u6ce8"),a(".follow").removeClass("already")):(a(".follow").text("\u5df2\u5173\u6ce8"),a(".follow").addClass("already")):a(".status").hasClass("on")?(a(".status").removeClass("on"),a(".status span").text("\u8bdd\u9898\u5173\u6ce8")):(a(".status").addClass("on"),a(".status span").text("\u5df2\u5173\u6ce8")))})},initialize:function(d){this.originalsViewInstance=d.originalsViewInstance;this.page=1;this.hasMore=this.lock=!0;a(".loading").hide();this.undelegateEvents();this.delegateEvents(this.events);
this.topic_id=d.topic_id;var b=this;ajax_request({action:"iwant_get_topic",topic_id:b.topic_id,pige_size:b.page_size}).then(function(c){if(0<c.errorCode)showError(c.errorMsg);else{b.page++;b.lock=!1;b.topic_type=c.topic.topic_type;if(1==c.topic.topic_type){var d=f.template(k,{title:"\u6d3b\u52a8\u8be6\u60c5"});a("header").replaceWith(d);a(".my_header").click(b.locationToMe)}else d=f.template(l,c.topic),a("header").replaceWith(d),a(".title .text").click(b.fixedDetail),a(".arrow_header").click(b.fixedDetail),
a(".my_header").click(b.locationToMe),a(".status").click(function(){b.follow()}),f.isEmpty(c.topic.topic_title)||a(".title_wrap .text").text(c.topic.topic_title);b.render(c);if(f.isEmpty(c.original_list)||c.original_list<b.page_size)b.hasMore=!1;f.isEmpty(c.original_list)?a(".center#content").append('<div class="nocontent"></div>'):b.originalsViewInstance.initialize(c.original_list,1);return ajax_request({action:"iwant_get_new_message_flag"})}}).then(function(b){b&&"0"==b.errorCode&&1==b.new_msg_flag&&
a(".my_header").html('<span class="dot">dot</span>')}).mobiCatch(function(a){showError(a.message)});a(window).off("scroll").on("scroll",function(){1!=b.topic_type&&0!=a(this).scrollTop()&&(a("#doc-detail").hide(),a("#fixed-detail").css("top","-100px"),a(".arrow_header").addClass("hide"));!b.lock&&a(this).scrollTop()+a(this).height()>=a("body").height()&&b.hasMore&&(b.lock=!0,a(".loading").show(),ajax_request({action:"iwant_get_original_list",topic_id:b.topic_id,page:b.page,page_size:b.page_size}).then(function(c){b.lock=
!1;a(".loading").hide();c.errorCode&&0<c.errorCode?showError(e.message):(b.page++,0>=c.original_list.length?b.hasMore=!1:(c.original_list.length<b.page_size&&(b.hasMore=!1),b.originalsViewInstance.initialize(c.original_list,1),setTimeout(function(){a("body").css("height",parseInt(a("#content").height())+parseInt(a("header").height())+"px")},300)))}))})},render:function(d){pageSlider.slidePage(a(this.template(d)));window.scrollTo(0,0)}})});
