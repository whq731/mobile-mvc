define("jquery underscore backbone text!src/tpl/iwant/topiclist.tpl text!src/tpl/iwant/optionbutton.tpl text!src/tpl/iwant/topiclist-detail.tpl text!src/tpl/iwant/topiclist-no.tpl text!src/tpl/iwant/header-self.tpl".split(" "),function(b,c,e,f,h,g,k,l){return e.View.extend({el:"body",template:c.template(f),loading:"#loading-inner",page:2,page_size:cfg.page_size,loading_flag:!0,interval:null,events:{"click #all":function(){location.href="#home"},"click #my":function(){location.href="#topic"}},bindEvent:function(a){a.each(function(a,
c){b(this).off("tap").on("tap",function(a){window.location.href=b(this).attr("url")})})},locationToMe:function(){ajax_request({action:"iwant_get_login_user"}).then(function(a){location.href=a.cust_id&&0<a.cust_id?"#me":cfg.login_link})},loadTemplate:function(){var a=this;a.loading_flag&&(a.loading_flag=!1,ajax_request({action:"iwant_get_my_concern_topic_list",page:1,page_size:a.page_size}).then(function(d){a.loading_flag=!0;b(".action_loading").hide();if(0==d.errorCode){try{a.render()}catch(m){throw Error({message:"Template error occurred!(topiclist.tpl)"});
}try{var e=c.template(l,{title:"iWant"});b("header").replaceWith(e);b(".my_header").click(a.locationToMe)}catch(f){throw Error({message:"Template error occurred!(header-self.tpl)"});}try{b(".change_label").empty().append(c.template(h)({channel:["topiclist"]}))}catch(n){throw Error({message:"Template error occurred!(optionbutton.tpl)"});}if(0>=d.result_list.length){try{setTimeout(function(){b(".index_list .topic").empty().append(c.template(k)())},300)}catch(p){throw Error({message:"Template error occurred!(topiclist-no.tpl)"});
}a.loading_flag=!1;b(a.loading).hide()}else{try{setTimeout(function(){b(".index_list .topic").empty().append(c.template(g)(d));a.bindEvent(b(".index_list .topic a.detail"))},300)}catch(q){throw Error({message:"Template error occurred!(topiclist-detail.tpl)"});}d.result_list.length>=a.page_size?(b("body"),setTimeout(function(){b(a.loading).show();b(window).off("scroll").on("scroll",function(){a.loading_flag&&b(this).scrollTop()+b(this).height()>=b("#topiclist_content").height()&&(a.loading_flag=!1,
ajax_request({action:"iwant_get_my_concern_topic_list",page:a.page,page_size:a.page_size}).then(function(d){a.loading_flag=!0;if(0==d.errorCode){a.page++;try{b(".index_list .topic").append(c.template(g)(d))}catch(e){throw Error({message:"Template error occurred!(topiclist-detail.tpl)"});}a.bindEvent(b(".index_list .topic a.detail"));d.scrollload=!0;d.result_list.length>=a.page_size?b(a.loading).show():(a.loading_flag=!1,b(a.loading).hide())}else a.catchError({})}));setTimeout(function(){a.loadImages()},
0)})},300)):(a.loading_flag=!1,b(a.loading).hide())}}else a.catchError({});return ajax_request({action:"iwant_get_new_message_flag"})}).then(function(a){a&&"0"==a.errorCode&&1==a.new_msg_flag&&b(".my_header").html('<span class="dot">99+</span>')}).mobiCatch(function(d){b(a.loading).hide()}))},catchError:function(a){if(!a.message)a.message="\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";else if(-1!=a.message.indexOf("undefined")||-1!=a.message.indexOf("null"))a.message="\u6570\u636e\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
b(this.loading).hide()},loadImages:function(){var a=this;b(".lazy").each(function(){b(window).scrollTop()+b(window).height()>=b(this).offset().top&&a.images(b(this))})},images:function(a){var b=new Image,c=a.attr("imgsrc");b.onload=function(){!0==b.complete&&(a.attr("src",c),a.removeClass("lazy"),a.removeAttr("imgsrc"))};b.src=c},initialize:function(){this.page=2;this.loading_flag=!0;b(".action_loading").show();b(this.loading).hide();b(window).off("scroll");this.loadTemplate()},render:function(){pageSlider.slidePage(b(this.template()));
b("body").scrollTop(0)}})});
