define("jquery underscore backbone text!src/tpl/iwant/home.tpl text!src/tpl/iwant/optionbutton.tpl text!src/tpl/iwant/home-turning.tpl text!src/tpl/iwant/recommend.tpl text!src/tpl/iwant/header-self.tpl iscroll".split(" "),function(b,d,f,g,k,l,h,m,n){return f.View.extend({el:"body",template:d.template(g),loading:"#loading-inner",page:2,page_size:cfg.page_size,loading_flag:!0,interval:null,_y:0,_x:0,_tempy:0,_tempx:0,events:{"click #all":function(){location.href="#home"},"click #my":"beforeMyTopic"},
beforeMyTopic:function(){ajax_request({action:"iwant_get_login_user"}).then(function(a){location.href=a.cust_id&&0<a.cust_id?"#topic":cfg.login_link})},bindEvent:function(a){a.each(function(a,d){b(this).off("tap").on("tap",function(a){window.location.href=b(this).attr("url")})})},locationToMe:function(){ajax_request({action:"iwant_get_login_user"}).then(function(a){location.href=a.cust_id&&0<a.cust_id?"#me":cfg.login_link})},loadTemplate:function(){var a=this;a.loading_flag&&(a.loading_flag=!1,ajax_request({action:"iwant_get_home_list",
page:1,page_size:a.page_size}).then(function(e){a.loading_flag=!0;if(0==e.errorCode){try{a.render()}catch(p){throw Error({message:"Template error occurred!(home.tpl)"});}try{var f=d.template(m,{title:"iWant"});b("header").replaceWith(f);b(".my_header").click(a.locationToMe);b("header .goback").attr("href","back://")}catch(g){throw Error({message:"Template error occurred!(header-self.tpl)"});}try{b(".change_label").empty().append(d.template(k)())}catch(n){throw Error({message:"Template error occurred!(optionbutton.tpl)"});
}try{b(".index_turning").empty().append(d.template(l)(e))}catch(q){throw Error({message:"Template error occurred!(home-turning.tpl)"});}try{setTimeout(function(){b(".index_list .recommend").empty().append(d.template(h)(e));a.bindEvent(b(".recommend li a"))},300)}catch(r){throw Error({message:"Template error occurred!(recommend.tpl)"});}e.recommend_topic_list.length>=a.page_size?(b("body"),setTimeout(function(){b(a.loading).show();b(window).off("scroll").on("scroll",function(){a.loading_flag&&b(this).scrollTop()+
b(this).height()>=b("#home_content").height()&&(a.loading_flag=!1,ajax_request({action:"iwant_get_topic_list",page:a.page,page_size:a.page_size}).then(function(c){a.loading_flag=!0;if(0==c.errorCode){a.page++;c.recommend_topic_list=c.result_list;try{b(".index_list .recommend").append(d.template(h)(c))}catch(e){throw Error({message:"Template error occurred!(recommend.tpl)"});}a.bindEvent(b(".recommend li a"));c.scrollload=!0;c.recommend_topic_list.length>=a.page_size?b(a.loading).show():(a.loading_flag=
!1,b(a.loading).hide())}else a.catchError({})}).mobiCatch(function(a){}));setTimeout(function(){a.loadImages()},0)})},300)):(a.loading_flag=!1,b(a.loading).hide());1<e.active_topic_list.length&&setTimeout(function(){var c=new IScroll(".index_turning#scroller",{scrollX:!0,snap:!0,momentum:!1,click:!0,preventDefault:!1,eventPassthrough:"vertical",snapSpeed:1E3});c.on("scrollEnd",function(){b(".index_turning .on").removeClass("on");b(".index_turning .dot li:eq("+this.currentPage.pageX+")").addClass("on");
clearInterval(a.interval);a.interval=null;a.interval=a.interval=setInterval(function(){c.currentPage.pageX>=c.pages.length-1?c.goToPage(0,0):c.next()},5E3)});a.interval=setInterval(function(){c.currentPage.pageX>=c.pages.length-1?c.goToPage(0,0):c.next()},5E3)},300);setTimeout(function(){a.loadImages()},0)}else a.catchError({});return ajax_request({action:"iwant_get_new_message_flag"})}).then(function(a){a&&"0"==a.errorCode&&1==a.new_msg_flag&&b(".my_header").html('<span class="dot">99+</span>')}).mobiCatch(function(e){b(a.loading).hide()}))},
catchError:function(a){if(!a.message)a.message="\u670d\u52a1\u5668\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";else if(-1!=a.message.indexOf("undefined")||-1!=a.message.indexOf("null"))a.message="\u6570\u636e\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";b(this.loading).hide()},loadImages:function(){var a=this;b(".lazy").each(function(){b(window).scrollTop()+b(window).height()>=b(this).offset().top&&a.images(b(this))})},images:function(a){var b=new Image,d=a.attr("imgsrc");b.onload=function(){!0==
b.complete&&(a.attr("src",d),a.removeClass("lazy"),a.removeAttr("imgsrc"))};b.src=d},initialize:function(){this.page=2;this.loading_flag=!0;b(this.loading).hide();b(window).off("scroll");this.loadTemplate()},render:function(){pageSlider.slidePage(b(this.template()));b("body").scrollTop(0)}})});
